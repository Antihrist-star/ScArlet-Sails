# –î–ï–ù–¨ 1 - –ó–ê–í–ï–†–®–Å–ù

**–î–∞—Ç–∞:** 2025-11-13
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–Å–ù

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1. ML —Ñ–∏–∫—Å - –ó–ê–í–ï–†–®–Å–ù
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω hardcoded '15m' timeframe –≤ feature extractor
- ‚úÖ ML —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö (15m, 1h, 4h, 1d)
- ‚úÖ OOD —Å–Ω–∏–∂–µ–Ω —Å 98.3% –¥–æ 8.1% –Ω–∞ BTC_15m
- ‚úÖ Comprehensive audit –ø–æ–∫–∞–∑–∞–ª: ML WR 57.8%, Hybrid WR 57.2%

### 2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤ - –ó–ê–í–ï–†–®–ï–ù–ê
- ‚úÖ TASKS_FOR_MATHEMATICIANS.md (805 —Å—Ç—Ä–æ–∫, 7 –∑–∞–¥–∞—á)
- ‚úÖ MATHEMATICAL_FOUNDATION_FOR_PJS.md (635 —Å—Ç—Ä–æ–∫)
- ‚úÖ MASTER_CHECKLIST_1MVP.md (534 —Å—Ç—Ä–æ–∫–∏)
- **–î–µ–¥–ª–∞–π–Ω –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤:** 2025-11-15 20:00 (48 —á–∞—Å–æ–≤)

### 3. ImprovedRuleBasedStrategy backtest - –ó–ê–í–ï–†–®–Å–ù

#### 3.1 Comparative Backtest (comprehensive audit)
**–ú–µ—Ç–æ–¥:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ 96 –±–∞—Ä–æ–≤, –±–µ–∑ SL, –±–µ–∑ –∏–∑–¥–µ—Ä–∂–µ–∫
**–¶–µ–ª—å:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –º–µ–∂–¥—É —Å–æ–±–æ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
Rule-Based:  WR 46.1%, PF 1.66, Trades 338,919
ML:          WR 57.8%, PF 4.36, Trades 136,568
Hybrid:      WR 57.2%, PF 3.48, Trades 127,792
```

**–í—ã–≤–æ–¥:** ML –∏ Hybrid –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ Rule-Based

#### 3.2 Realistic Backtest (—Å SL –∏ –∏–∑–¥–µ—Ä–∂–∫–∞–º–∏)
**–ú–µ—Ç–æ–¥:** TP +1%, SL -0.5%, –∏–∑–¥–µ—Ä–∂–∫–∏ 0.3%, exit –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–±—ã—Ç–∏–∏
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã Rule-Based:**
```
Original:    WR 36.8%, PF 0.52, Return -100%, Sharpe -61.06
Improved v1: WR 36.8%, PF 0.52, Return -100%, Sharpe -60.98
Improved v2: WR 37.7%, PF 0.54, Return -100%, Sharpe -57.80 (–ª—É—á—à–∏–π)
```

**Exit reasons (Original):**
- Take Profit: 8,673 (34.4%)
- Stop Loss: 15,247 (60.5%) ‚Üê SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∞—â–µ!
- Time limit: 1,267 (5.0%)

**–í—ã–≤–æ–¥:** Rule-Based —É–±—ã—Ç–æ—á–Ω–∞ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏. –ù—É–∂–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è (OpportunityScorer, –ª—É—á—à–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã).

---

## üìä –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´ –î–ï–ù–¨ 1

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **ML –º–æ–¥–µ–ª—å:** WR 57.8%, PF 4.36 (comparative)
2. **Hybrid –º–æ–¥–µ–ª—å:** WR 57.2%, PF 3.48 (comparative)
3. **ML —Ñ–∏–∫—Å —É—Å–ø–µ—à–µ–Ω:** OOD 8.1% –≤–º–µ—Å—Ç–æ 98.3%

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —É–ª—É—á—à–µ–Ω–∏–∏:
1. **Rule-Based:** WR 36.8%, PF 0.52 (realistic) - —É–±—ã—Ç–æ—á–Ω–∞
   - SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ (60.5% trades)
   - –ù—É–∂–µ–Ω OpportunityScorer –¥–ª—è –ª—É—á—à–µ–π —Å–µ–ª–µ–∫—Ü–∏–∏
   - –ù—É–∂–Ω—ã —É–ª—É—á—à–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (Regime, Crisis)

### üîÑ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –î–µ–Ω—å 2:
1. **ML realistic backtest** - –æ—Å—Ç–∞—ë—Ç—Å—è –ª–∏ WR 57.8% —Å SL –∏ –∏–∑–¥–µ—Ä–∂–∫–∞–º–∏?
2. **Hybrid realistic backtest** - –æ—Å—Ç–∞—ë—Ç—Å—è –ª–∏ profitable?
3. **OpportunityScorer** - —É–ª—É—á—à–∏—Ç –ª–∏ —Å–µ–ª–µ–∫—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤?

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `reports/TASKS_FOR_MATHEMATICIANS.md`
- `reports/MATHEMATICAL_FOUNDATION_FOR_PJS.md`
- `reports/MASTER_CHECKLIST_1MVP.md`
- `reports/DAY1_PROGRESS.md`
- `reports/TIMEFRAME_FIX_DIAGNOSTIC.md`

### –°–∫—Ä–∏–ø—Ç—ã:
- `scripts/backtest_improved_rule_based.py` (comparative)
- `scripts/backtest_improved_realistic.py` (realistic —Å SL/–∏–∑–¥–µ—Ä–∂–∫–∞–º–∏)
- `scripts/verify_timeframe_fix.py`
- `scripts/clear_python_cache.sh`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `models/pjs_components.py` (SimpleOpportunityScorer, CostCalculator, RiskPenaltyCalculator, ImprovedRuleBasedStrategy, PjS_Calculator)

### –ú–æ–¥–µ–ª–∏ (–æ–±—É—á–µ–Ω–Ω—ã–µ):
- `models/xgboost_normalized_model.json`
- `models/xgboost_normalized_scaler.pkl`
- `models/xgboost_normalized_features.json`

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- `reports/comprehensive_model_audit.json` (–≤—Å–µ 56 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
- `reports/improved_rule_based_backtest_20251113_191159.json` (comparative)
- `reports/realistic_backtest_20251113_191853.json` (realistic)

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–î–µ–Ω—å 2)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: Realistic backtest –¥–ª—è ML/Hybrid
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ—Å—Ç–∞—é—Ç—Å—è –ª–∏ –æ–Ω–∏ profitable —Å SL –∏ –∏–∑–¥–µ—Ä–∂–∫–∞–º–∏

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å realistic backtest –¥–ª—è ML
2. –°–æ–∑–¥–∞—Ç—å realistic backtest –¥–ª—è Hybrid
3. –°—Ä–∞–≤–Ω–∏—Ç—å —Å Rule-Based

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ML: WR –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å —Å 57.8% –¥–æ ~45-50%, –Ω–æ PF –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è >1.0
- Hybrid: WR –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å —Å 57.2% –¥–æ ~50-55%, PF –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è >1.5

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpportunityScorer
**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å —Å–µ–ª–µ–∫—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤

**–ó–∞–¥–∞—á–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å SimpleOpportunityScorer –≤ entry logic
2. Condition: opportunity_score > threshold (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.5)
3. Backtest —Å OpportunityScorer
4. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ/–ø–æ—Å–ª–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: CostCalculator
**–¶–µ–ª—å:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—á—ë—Ç –∏–∑–¥–µ—Ä–∂–µ–∫ –≤–æ –≤—Å–µ—Ö backtests

**–ó–∞–¥–∞—á–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å CostCalculator –≤ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã
2. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å (maker/taker fee, slippage)
3. –ß–µ—Å—Ç–Ω—ã–µ PF –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: RiskPenaltyCalculator (–∂–¥—ë–º –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤)
**–ó–∞–¥–∞—á–∏:**
1. –ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤ (–ó–∞–¥–∞—á–∞ #2: Risk Aggregation)
2. –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–º –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è ‚Üí –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–µ—Ä–µ–Ω–æ—Å–∏–º –Ω–∞ –î–µ–Ω—å 3

---

## üìã –°–¢–ê–¢–£–° –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô

### –û—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤ (–¥–µ–¥–ª–∞–π–Ω 2025-11-15 20:00):
- ‚è≥ –ó–∞–¥–∞—á–∞ #1: Regime Detection (–¥–ª—è –î–µ–Ω—å 3)
- ‚è≥ –ó–∞–¥–∞—á–∞ #2: Risk Aggregation (–¥–ª—è –î–µ–Ω—å 2-3)
- ‚è≥ –ó–∞–¥–∞—á–∞ #3: Class Imbalance (–¥–ª—è –î–µ–Ω—å 4)

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:
- ‚úÖ ML —Ñ–∏–∫—Å –∑–∞–≤–µ—Ä—à—ë–Ω
- ‚úÖ P_j(S) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ Backtest —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã

---

## üí° –£–†–û–ö–ò –î–ï–ù–¨ 1

### 1. –î–≤–∞ —Ç–∏–ø–∞ backtest - –æ–±–∞ –Ω—É–∂–Ω—ã
- **Comparative:** –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è)
- **Realistic:** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å (SL, –∏–∑–¥–µ—Ä–∂–∫–∏, slippage)

### 2. –•–æ—Ä–æ—à–∏–µ comparative —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚â† profitable –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
- Rule-Based: WR 46.1% (comparative) ‚Üí 36.8% (realistic)
- –ù—É–∂–Ω—ã –æ–±–∞ —Ç–µ—Å—Ç–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã

### 3. ML/Hybrid –≤—ã–≥–ª—è–¥—è—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ Rule-Based –≤ comparative
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ realistic —É—Å–ª–æ–≤–∏—è—Ö (–î–µ–Ω—å 2)

### 4. OpportunityScorer –∫—Ä–∏—Ç–∏—á–µ–Ω
- Simple Rule-Based (RSI < 30) –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –ù—É–∂–Ω–∞ smart —Å–µ–ª–µ–∫—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

---

## ‚úÖ –î–ï–ù–¨ 1 –ó–ê–í–ï–†–®–Å–ù –£–°–ü–ï–®–ù–û

**–í—Ä–µ–º—è:** ~4 —á–∞—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
**–ö–æ–º–º–∏—Ç—ã:** 10 –∫–æ–º–º–∏—Ç–æ–≤
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞/–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~3,500 —Å—Ç—Ä–æ–∫
**–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 15+

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –î–µ–Ω—å 2:** 100% ‚úÖ

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–µ–Ω—å 2 - Realistic backtest ML/Hybrid + OpportunityScorer integration
